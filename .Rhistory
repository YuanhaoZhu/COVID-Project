
DATE >= dev_phase & DATE < outbreak_phase ~ 1,
DATE >= outbreak_phase ~ 2
))
covid <- mutate(covid, mortality_rate = TC/TD)
# 0 = UNDERDEVELOPED, 1 = DEVELOPING, 2 = DEVELOPED
covid$type[covid$GDPCAP<5338.454]<-0
covid$type[covid$GDPCAP>= 5338.454 & covid$GDPCAP<31400.840]<- 1
covid$type[covid$GDPCAP>=31400.840 ]<- 2
# covid <- drop_na(covid)
study_data <- covid[, 9:14]
summary(study_data)
upper<-cor(study_data)
upper[upper.tri(cor(study_data))]<-""
upper<-as.data.frame(upper)
upper
# Time Phase
begin_phase = min(covid$DATE)
dev_phase = as.Date("2020-03-01", format = "%Y-%m-%d")
outbreak_phase = as.Date("2020-07-01", format = "%Y-%m-%d")
# 0 = beginning phase, 1 = developing phase, 2 = outbreak phase
covid <- mutate(covid, phase = case_when(
DATE < dev_phase ~ 0,
DATE >= dev_phase & DATE < outbreak_phase ~ 1,
DATE >= outbreak_phase ~ 2
))
covid <- mutate(covid, mortality_rate = TC/TD)
# 0 = UNDERDEVELOPED, 1 = DEVELOPING, 2 = DEVELOPED
covid$type[covid$GDPCAP<5338.454]<-0
covid$type[covid$GDPCAP>= 5338.454 & covid$GDPCAP<31400.840]<- 1
covid$type[covid$GDPCAP>=31400.840 ]<- 2
covid <- drop_na(covid)
covid
study_data <- covid[, 9:14]
study_data
covid
# Time Phase
begin_phase = min(covid$DATE)
dev_phase = as.Date("2020-03-01", format = "%Y-%m-%d")
outbreak_phase = as.Date("2020-07-01", format = "%Y-%m-%d")
# 0 = beginning phase, 1 = developing phase, 2 = outbreak phase
covid <- mutate(covid, phase = case_when(
DATE < dev_phase ~ 0,
DATE >= dev_phase & DATE < outbreak_phase ~ 1,
DATE >= outbreak_phase ~ 2
))
covid <- mutate(covid, mortality_rate = TC/TD)
# 0 = UNDERDEVELOPED, 1 = DEVELOPING, 2 = DEVELOPED
covid$type[covid$GDPCAP<5338.454]<-0
covid$type[covid$GDPCAP>= 5338.454 & covid$GDPCAP<31400.840]<- 1
covid$type[covid$GDPCAP>=31400.840 ]<- 2
covid <- drop_na(covid)
study_data <- covid[, 4:9]
study_data
summary(study_data)
upper<-cor(study_data)
upper[upper.tri(cor(study_data))]<-""
upper<-as.data.frame(upper)
upper
# Time Phase
begin_phase = min(covid$DATE)
dev_phase = as.Date("2020-03-01", format = "%Y-%m-%d")
outbreak_phase = as.Date("2020-07-01", format = "%Y-%m-%d")
# 0 = beginning phase, 1 = developing phase, 2 = outbreak phase
covid <- mutate(covid, phase = case_when(
DATE < dev_phase ~ 0,
DATE >= dev_phase & DATE < outbreak_phase ~ 1,
DATE >= outbreak_phase ~ 2
))
covid <- mutate(covid, mortality_rate = TC/TD)
# 0 = UNDERDEVELOPED, 1 = DEVELOPING, 2 = DEVELOPED
covid$type[covid$GDPCAP<5338.454]<-0
covid$type[covid$GDPCAP>= 5338.454 & covid$GDPCAP<31400.840]<- 1
covid$type[covid$GDPCAP>=31400.840 ]<- 2
covid <- drop_na(covid)
study_data <- covid[, 9:14]
study_data
summary(study_data)
upper<-cor(study_data)
upper[upper.tri(cor(study_data))]<-""
upper<-as.data.frame(upper)
upper

scaleFUN <- function(x) sprintf("%.5f", x)
rev <- regressiondata$HDI
ggplot(data = melt(rev), aes(x = value)) +
stat_density() +
ggtitle("Plot of HDI Distribution") +
theme(plot.title = element_text(hjust = 0.5)) +
scale_x_continuous(labels=scales::dollar_format()) +
scale_y_continuous(labels=scaleFUN) +
geom_vline(xintercept = mean(rev), linetype="dotted",
color = "red", size=1.5)
library(reshape)
scaleFUN <- function(x) sprintf("%.5f", x)
rev <- regressiondata$GDPCAP
ggplot(data = melt(rev), aes(x = value)) +
stat_density() +
ggtitle("Plot of GDPCAP Distribution") +
theme(plot.title = element_text(hjust = 0.5)) +
scale_x_continuous(labels=scales::dollar_format()) +
scale_y_continuous(labels=scaleFUN) +
geom_vline(xintercept = mean(rev), linetype="dotted",
color = "red", size=1.5)
par(mfrow=c(2,2))
plot(m2)
regressiondata$HDI = as.integer(regressiondata$HDI)
regressiondata$GDPCAP = as.integer(regressiondata$GDPCAP)
gdp.glm <- glm(GDPCAP ~TC + STI+ TD + HDI, family="poisson", data=regressiondata)
summary(gdp.glm)
mu <- mean(regressiondata$GDPCAP)
plot(log(fitted(gdp.glm)),log((regressiondata$GDPCAP-fitted(gdp.glm))^2),xlab=expression(hat(mu)),ylab=expression((y-hat(mu))^2),pch=20,col="blue")
abline(0,1)
dp = sum(residuals(gdp.glm,type ="pearson")^2)/gdp.glm$df.residual
print(dp)
regressiondata$HDI = as.factor(regressiondata$HDI)
gdp.glm <- glm(GDPCAP ~TC + STI+ TD + HDI, family="poisson", data=regressiondata)
regressiondata$HDI = as.integer(regressiondata$HDI)
regressiondata$GDPCAP = as.integer(regressiondata$GDPCAP)
gdp.glm <- glm(GDPCAP ~TC + STI+ TD + HDI, family="poisson", data=regressiondata)
summary(gdp.glm)
mu <- mean(regressiondata$GDPCAP)
plot(log(fitted(gdp.glm)),log((regressiondata$GDPCAP-fitted(gdp.glm))^2),xlab=expression(hat(mu)),ylab=expression((y-hat(mu))^2),pch=20,col="blue")
abline(0,1)
dp = sum(residuals(gdp.glm,type ="pearson")^2)/gdp.glm$df.residual
print(dp)
regressiondata$HDI = as.integer(regressiondata$HDI)
regressiondata$GDPCAP = as.integer(regressiondata$GDPCAP)
gdp.glm <- glm(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE, family="poisson", data=regressiondata)
summary(gdp.glm)
mu <- mean(regressiondata$GDPCAP)
plot(log(fitted(gdp.glm)),log((regressiondata$GDPCAP-fitted(gdp.glm))^2),xlab=expression(hat(mu)),ylab=expression((y-hat(mu))^2),pch=20,col="blue")
abline(0,1)
dp = sum(residuals(gdp.glm,type ="pearson")^2)/gdp.glm$df.residual
print(dp)
library(MASS)
rev.glm <- glm.nb(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE,data=regressiondata , maxit = 100)
summary(rev.glm)
plot(rev.glm)
head(regressiondata)
m2<-lm(HDI~ TC + STI+ GDPCAP+ TD:TYPE,data=regressiondata)
summary(m2)
regressiondata$HDI = as.integer(regressiondata$HDI)
regressiondata$GDPCAP = as.integer(regressiondata$GDPCAP)
gdp.glm <- glm(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE, family="poisson", data=regressiondata)
summary(gdp.glm)
mu <- mean(regressiondata$GDPCAP)
plot(log(fitted(gdp.glm)),log((regressiondata$GDPCAP-fitted(gdp.glm))^2),xlab=expression(hat(mu)),ylab=expression((y-hat(mu))^2),pch=20,col="blue")
abline(0,1)
dp = sum(residuals(gdp.glm,type ="pearson")^2)/gdp.glm$df.residual
print(dp)
library(MASS)
rev.glm <- glm.nb(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE,data=regressiondata , maxit = 100)
summary(rev.glm)
plot(rev.glm)
library(MASS)
regressiondata$TYPE = as.factor(regressiondata$TYPE)
rev.glm <- glm.nb(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE,data=regressiondata , maxit = 100)
summary(rev.glm)
plot(rev.glm)
regressiondata$TYPE
return(n)

#We use the raw data in sheet 2 for data processing. The transformed data is ill structured. For instance ln1 is 0 and missing values were also assigned value 0.
library("readxl")
library("dplyr")
rawdata <- read_excel("COVID.xlsx", sheet = "Sheet2",col_names=T,range = cell_cols(1:9))
colnames(rawdata)<-c("CODE","COUNTRY",	"DATE",	"TC",	"TD","STI",	"POP","GDPCAP","HDI")
#a function take natrual log and leave 0 if the cell is 0 and NA if the cell is NA
avoid_zero_ln<-function(x){
n=ifelse(x == 0, 0, log(x))
return(n)
}
data<-rawdata %>% mutate_at(c("TC",	"TD","STI",	"POP","GDPCAP"), avoid_zero_ln)
colnames(data)<-c("CODE","COUNTRY",	"DATE",	"logTC",	"logTD","logSTI",	"logPOP","logGDPCAP","HDI")
#keep both variables in log scale and original ones.
#The processed data is  called covid. Note that NA values are perserved.
covid<-cbind(data,rawdata[,c(4:8)])
head(covid)
#function to calculate mortality rate, return 0 if no case or if no death
mrate<-function(td,tc){
if (td==0){mortality<-0}
else{mortality<-td/tc}
return (mortality)
}
# Time Phase
begin_phase = as.Date("2020-02-01", format = "%Y-%m-%d")
dev_phase = as.Date("2020-05-01", format = "%Y-%m-%d")
outbreak_phase = as.Date("2020-07-01", format = "%Y-%m-%d")
regressiondata <- covid %>%  mutate(PHASE = case_when(
DATE<=begin_phase ~ 0,
DATE> begin_phase &DATE <=dev_phase ~ 1,
DATE>=dev_phase ~ 2
))%>% filter(DATE==begin_phase |DATE==dev_phase|DATE==outbreak_phase)
# 0 = UNDERDEVELOPED, 1 = DEVELOPING, 2 = DEVELOPED
regressiondata$TYPE[regressiondata$GDPCAP<5338.454]<- 0
regressiondata$TYPE[regressiondata$GDPCAP>= 5338.454 & regressiondata$GDPCAP<31400.840]<- 1
covid$TYPE[covid$GDPCAP>=31400.840 ]<- 2
regressiondata<-drop_na(regressiondata)
regressiondata$mortality_rate<-as.vector(mapply(mrate,regressiondata$TD,regressiondata$TC))*100
regressiondata$PHASE<-as.factor(regressiondata$PHASE)
regressiondata$TYPE<-as.factor(regressiondata$TYPE)
regressiondata$GDP<- regressiondata$POP *regressiondata$GDPCAP
regressiondata$logGDP<- log(regressiondata$POP *regressiondata$GDPCAP)
head(regressiondata)
regressiondata$HDI = as.integer(regressiondata$HDI)
regressiondata$GDPCAP = as.integer(regressiondata$GDPCAP)
gdp.glm <- glm(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE, family="poisson", data=regressiondata)
summary(gdp.glm)
mu <- mean(regressiondata$GDPCAP)
plot(log(fitted(gdp.glm)),log((regressiondata$GDPCAP-fitted(gdp.glm))^2),xlab=expression(hat(mu)),ylab=expression((y-hat(mu))^2),pch=20,col="blue")
abline(0,1)
dp = sum(residuals(gdp.glm,type ="pearson")^2)/gdp.glm$df.residual
print(dp)
regressiondata$TYPE
library(MASS)
rev.glm <- glm.nb(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE,data=regressiondata , maxit = 100)
summary(rev.glm)
plot(rev.glm)
# Time Phase
begin_phase = as.Date("2020-02-01", format = "%Y-%m-%d")
dev_phase = as.Date("2020-05-01", format = "%Y-%m-%d")
outbreak_phase = as.Date("2020-07-01", format = "%Y-%m-%d")
regressiondata <- covid %>%  mutate(PHASE = case_when(
DATE<=begin_phase ~ 0,
DATE> begin_phase &DATE <=dev_phase ~ 1,
DATE>=dev_phase ~ 4
))%>% filter(DATE==begin_phase |DATE==dev_phase|DATE==outbreak_phase)
# 0 = UNDERDEVELOPED, 1 = DEVELOPING, 2 = DEVELOPED
regressiondata$TYPE[regressiondata$GDPCAP<5338.454]<- 0
regressiondata$TYPE[regressiondata$GDPCAP>= 5338.454 & regressiondata$GDPCAP<31400.840]<- 1
covid$TYPE[covid$GDPCAP>=31400.840 ]<- 2
regressiondata<-drop_na(regressiondata)
regressiondata$mortality_rate<-as.vector(mapply(mrate,regressiondata$TD,regressiondata$TC))*100
regressiondata$PHASE<-as.factor(regressiondata$PHASE)
regressiondata$TYPE<-as.factor(regressiondata$TYPE)
regressiondata$GDP<- regressiondata$POP *regressiondata$GDPCAP
regressiondata$logGDP<- log(regressiondata$POP *regressiondata$GDPCAP)
head(regressiondata)
library(MASS)
rev.glm <- glm.nb(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE,data=regressiondata , maxit = 100)
summary(rev.glm)
plot(rev.glm)
# Time Phase
begin_phase = as.Date("2020-02-01", format = "%Y-%m-%d")
dev_phase = as.Date("2020-05-01", format = "%Y-%m-%d")
outbreak_phase = as.Date("2020-07-01", format = "%Y-%m-%d")
regressiondata <- covid %>%  mutate(PHASE = case_when(
DATE<=begin_phase ~ 0,
DATE> begin_phase &DATE <=dev_phase ~ 1,
DATE>=dev_phase ~ 2
))%>% filter(DATE==begin_phase |DATE==dev_phase|DATE==outbreak_phase)
# 0 = UNDERDEVELOPED, 1 = DEVELOPING, 2 = DEVELOPED

covid$type[covid$GDPCAP<5338.454]<-0
covid$type[covid$GDPCAP>= 5338.454 & covid$GDPCAP<31400.840]<- 1
covid$type[covid$GDPCAP>=31400.840 ]<- 2
# covid[is.na(covid)] <- 0
covid <- covid %>% drop_na()
study_data <- covid[, 4:9] # c(9,10,11,12,14)
upper<-cor(study_data)
upper[upper.tri(cor(study_data))]<-""
upper<-as.data.frame(upper)
upper
upper<-cor(study_data)
upper[upper.tri(cor(study_data))]<-""
upper<-as.data.frame(upper)
upper
# OLS
pov.ols <- lm(HDI~., data = study_data)
summary(pov.ols)
opar <- par(mfrow = c(2,2), oma = c(0, 0, 1.1, 0))
plot(pov.ols, las = 1)
# RLS
pov.rls <- rlm(HDI~. , data=study_data, psi = psi.hampel) #, psi = psi.bisquare
summary(pov.rls)
# Weighted R2
r2ww <- function(x){
SSe <- sum((x$w*x$resid)^2); #the residual sum of squares is weighted
observed <- x$resid+x$fitted;
SSt <- sum((x$w*(observed-mean(observed)))^2); #the total sum of squares is weighted
value <- 1-SSe/SSt;
return(value);
}
print(paste0("Weighted R2 = ",round(r2ww(pov.rls),5)))
# OLS
pov.ols <- lm(GDPCAP~., data = study_data)
# OLS
pov.ols <- lm(logGDPCAP~., data = study_data)
summary(pov.ols)
opar <- par(mfrow = c(2,2), oma = c(0, 0, 1.1, 0))
plot(pov.ols, las = 1)
# RLS
pov.rls <- rlm(logGDPCAP~. , data=study_data, psi = psi.hampel) #, psi = psi.bisquare
summary(pov.rls)
# Weighted R2
r2ww <- function(x){
SSe <- sum((x$w*x$resid)^2); #the residual sum of squares is weighted
observed <- x$resid+x$fitted;
SSt <- sum((x$w*(observed-mean(observed)))^2); #the total sum of squares is weighted
value <- 1-SSe/SSt;
return(value);
}
print(paste0("Weighted R2 = ",round(r2ww(pov.rls),5)))
knitr::opts_chunk$set(echo = TRUE)
#We use the raw data in sheet 2 for data processing. The transformed data is ill structured. For instance ln1 is 0 and missing values were also assigned value 0.
library("readxl")
knitr::opts_chunk$set(echo = TRUE)
#We use the raw data in sheet 2 for data processing. The transformed data is ill structured. For instance ln1 is 0 and missing values were also assigned value 0.
library("readxl")
insrall.packages("readxl")
install.packages("readxl")
install.packages("dplyr")
knitr::opts_chunk$set(echo = TRUE)
#We use the raw data in sheet 2 for data processing. The transformed data is ill structured. For instance ln1 is 0 and missing values were also assigned value 0.
library("readxl")
library("dplyr")
rawdata <- read_excel("COVID.xlsx", sheet = "Sheet2",col_names=T,range = cell_cols(1:9))
colnames(rawdata)<-c("CODE","COUNTRY",	"DATE",	"TC",	"TD","STI",	"POP","GDPCAP","HDI")
#a function take natrual log and leave 0 if the cell is 0 and NA if the cell is NA
avoid_zero_ln<-function(x){
n=ifelse(x == 0, 0, log(x))
return(n)
}
data<-rawdata %>% mutate_at(c("TC",	"TD","STI",	"POP","GDPCAP"), avoid_zero_ln)
colnames(data)<-c("CODE","COUNTRY",	"DATE",	"logTC",	"logTD","logSTI",	"logPOP","logGDPCAP","HDI")
#keep both variables in log scale and original ones.
#The processed data is  called covid. Note that NA values are perserved.
covid<-cbind(data,rawdata[,c(4:8)])
head(covid)
library("ggplot2")
theme_set(theme_bw())
library("sf")
install.packages("sf")
library("ggplot2")
theme_set(theme_bw())
library("sf")
library("rnaturalearth")
install.packages("rnaturalearth")
library("ggplot2")
theme_set(theme_bw())
library("sf")
library("rnaturalearth")
library("rnaturalearthdata")
library("ggplot2")
theme_set(theme_bw())
library("sf")
library("rnaturalearth")
library("rnaturalearthdata")
install.packages("rnaturalearthdata")
library("ggplot2")
theme_set(theme_bw())
library("sf")
library("rnaturalearth")
library("rnaturalearthdata")
library("maps")
install.packages("maps")
library("ggplot2")
theme_set(theme_bw())
library("sf")
library("rnaturalearth")
library("rnaturalearthdata")
library("maps")
world_map <- map_data("world")
world_map <- map_data("world")
deathrate<-c()
for( i in unique(covid$COUNTRY)){
d<-covid[covid$COUNTRY==i,11]
p<-covid[covid$COUNTRY==i,13]
if(all(is.na(p)) |all(is.na(d)) ){rate<-NA}
else{
totaldeath<-max(d,na.rm=T)
population<-max(p,na.rm = T)
rate<-(totaldeath/population)*100}
deathrate<-c(deathrate,rate)
}
d_rate<-data.frame(region=unique(covid$COUNTRY), deathrate)
levels(d_rate$region)[levels(d_rate$region)=="United States"] <- "USA"
comb <- left_join(world_map,d_rate, by = "region")
ggplot(comb, aes(long, lat, group = group))+
geom_polygon(aes(fill = deathrate ), color = "white")+
scale_fill_viridis_c(
alpha = 0.7,
begin = 0,
end = 1,
direction = -1,
option = "A",
values = NULL,
space = "Lab",
na.value = "grey80",
guide = "colourbar",
aesthetics = "fill"
)+labs(title="World Map of Total Death Rate for Each Country",
x ="Longitude", y = "Latitude7")
# plot trend of covid cases and death world wide
sub_covid<-covid[,c('DATE',"TC","TD")]
sub_covid$FDATE<-as.factor(sub_covid$DATE)
world_cases<-aggregate(TC~FDATE, data=sub_covid, FUN=sum ,na.action=na.omit)
world_death<-aggregate(TD~FDATE, data=sub_covid, FUN=sum ,na.action=na.omit)
world_death<-subset(world_death, select = -c(1) )
world_cd<-cbind(world_cases,world_death)
world_cd$logTC<-log(world_cd$TC)
world_cd$logTD<-log(world_cd$TD)
ggplot(data = world_cd, aes(x = as.Date(FDATE))) +
geom_line(aes(y = logTC, colour = "logTC")) +
geom_line(aes(y = logTD, colour = "logTD")) +
scale_colour_manual("", values = c("logTC"="green", "logTD"="red")) +
xlab("time") +
ylab("log counts")+
labs(title="total cases and deaths worldwide in log scale")
#plot correlation between GDP VS STI AND
deathrate<-c()
for( i in unique(covid$COUNTRY)){
d<-covid[covid$COUNTRY==i,11]
p<-covid[covid$COUNTRY==i,13]
if(all(is.na(p)) |all(is.na(d)) ){rate<-NA}
else{
totaldeath<-max(d,na.rm=T)
population<-max(p,na.rm = T)
rate<-(totaldeath/population)*100}
deathrate<-c(deathrate,rate)
}
#correlation of total death vs HDI is different for underdeveloped developing and developed countries, result of the paper may be wrong!
quantile(covid$GDPCAP,na.rm=T)
bygdp<-covid[,c('COUNTRY',"TD","GDPCAP","HDI")]
bygdp$type[bygdp$GDPCAP<5338.454]<-"UNDERDEVELOPED"
bygdp$type[bygdp$GDPCAP> 5338.454 &bygdp$GDPCAP<31400.840]<-"DEVELOPING"
bygdp$type[bygdp$GDPCAP>31400.840 ]<-"DEVELOPED"
ud<-bygdp[bygdp$type=="UNDERDEVELOPED",]
d<-bygdp[bygdp$type=="DEVELOPING",]
dd<-bygdp[bygdp$type=="DEVELOPED",]
ud_corr<-cor(ud$TD,ud$HDI,use="pairwise.complete.obs")
d_corr<-cor(d$TD,d$HDI,use="pairwise.complete.obs")
dd_corr<-cor(dd$TD,dd$HDI,use="pairwise.complete.obs")
ud_p<-cor.test(ud$TD,ud$HDI,use="pairwise.complete.obs")$p.value
d_p<-cor.test(d$TD,d$HDI,use="pairwise.complete.obs")$p.value
dd_p<-cor.test(dd$TD,dd$HDI,use="pairwise.complete.obs")$p.value
data.frame(type=c("underdeveloped","developing","developed"),corrs=c(ud_corr,d_corr,dd_corr),pval=c(ud_p,d_p,dd_p))
library(tidyverse)
install.packages("tidyverse")
install.packages("tidyverse")
install.packages("tidyverse")
install.packages("tidyverse")
install.packages('tidyverse')
install.packages("tidyverse")
install.packages("tidyverse")
install.packages("tidyverse")
install.packages("tidyverse")

regressiondata$TYPE[regressiondata$GDPCAP<5338.454]<- 0
regressiondata$TYPE[regressiondata$GDPCAP>= 5338.454 & regressiondata$GDPCAP<31400.840]<- 1
covid$TYPE[covid$GDPCAP>=31400.840 ]<- 2
regressiondata<-drop_na(regressiondata)
regressiondata$mortality_rate<-as.vector(mapply(mrate,regressiondata$TD,regressiondata$TC))*100
regressiondata$PHASE<-as.factor(regressiondata$PHASE)
regressiondata$TYPE<-as.factor(regressiondata$TYPE)
regressiondata$GDP<- regressiondata$POP *regressiondata$GDPCAP
regressiondata$logGDP<- log(regressiondata$POP *regressiondata$GDPCAP)
head(regressiondata)
library(MASS)
rev.glm <- glm.nb(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE,data=regressiondata , maxit = 100)
summary(rev.glm)
plot(rev.glm)
regressiondata$GDPCAP = as.integer(regressiondata$GDPCAP)
rev.glm <- glm.nb(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE,data=regressiondata , maxit = 100)
summary(rev.glm)
plot(rev.glm)
library(MASS)
regressiondata$GDPCAP = as.integer(regressiondata$GDPCAP)
rev.glm <- glm.nb(GDPCAP ~TC + STI+ TD + mortality_rate + TYPE + PHASE,data=regressiondata , maxit = 100)
summary(rev.glm)
plot(rev.glm)
library(MASS)
regressiondata$GDPCAP = as.integer(regressiondata$GDPCAP)
rev.glm <- glm.nb(GDPCAP ~TC + STI+ TD + HDI + mortality_rate + TYPE + PHASE,data=regressiondata , maxit = 100)
summary(rev.glm)
plot(rev.glm)
library("dplyr")
library('forecast')
library(tidyverse)
library(leaps)
library(ggplot2)
library(reshape)
library(chron)
admission = read.csv("../data/final_csv/final.csv")
admission$plan_date <- as.Date(admission$plan_date , format = "%Y-%m-%d")
admission$transaction_date <- as.Date(admission$transaction_date , format = "%Y-%m-%d")
admission = subset(admission, select = -c(Date) )
head(admission)
# unique(admission$transaction_date)
admission$Radius = as.numeric(admission$Radius)
mean(admission$Radius, na.rm = TRUE)
COVID_START <-  as.Date("2020-02-01" , format = "%Y-%m-%d")
by_day <- admission %>%
group_by(transaction_date) %>%
summarise(
adm_count = sum(quantity),
revenue = sum(extension),
cat_general = sum(quantity[category == 'ADMISSION ']),
cat_combo = sum(quantity[category == 'COMBOADMIS']),
# Item
adult = sum(quantity[item == 'ADULT     ']),
youth = sum(quantity[item =='YOUTH     ']),
child = sum(quantity[item=='CHILD     ']),
senior = sum(quantity[item=='SENIOR    ']),
child4 = sum(quantity[item=='CHILD4    ']),
avg_pcsplit_2 = mean(pcsplit_2),
teacher = sum(quantity[item=='TEACHER   ']),
driver = sum(quantity[item=='DRIVER    ']),
avg_transaction_time = mean(times(transaction_time)),
total_michigan = sum(quantity[STATE =="MI"  ]),
###
avg_pr_ctr_1 = mean(pr_ctr_1),
avg_pcsplit_1 = mean(pcsplit_1),
avg_pr_ctr_2 = mean(pr_ctr_2),
total_primary = sum(quantity[MARKET =="Primary"  ]),
total_secondary = sum(quantity[MARKET =="Secondary"  ]),
total_core = sum(quantity[MARKET =="Core"  ]),
total_not_michigan = sum(quantity[STATE !="MI"  ]),
prcp = mean(PRCP_in),
snow = mean(SNOW),
tmax = mean(TMAX_F),
tmin = mean(TMIN_F),
avg_purchase_window = mean(adv_purchase_window),
avg_gas_price = mean(price_per_gallon),
num_discounts = sum(quantity[str_length(special) > 0]),
total_discount_amt = sum(disc_amt),
avg_radius = mean(Radius, na.rm = TRUE),
# Exhibits attendance
towers_attendance = sum(quantity[towers_of_tomorrow == 1]),
house_attendance = sum(quantity[house_industries == 1]),
eames_attendance = sum(quantity[charles_and_ray_Eames == 1]),
am_style_attendance = sum(quantity[american_style == 1]),
end_ideal_attendance = sum(quantity[enduring_ideals == 1]),
eng_exp_attendance = sum(quantity[engines_exposed == 1]),
pixar_attendance = sum(quantity[pixar == 1]),
star_trek_attendance = sum(quantity[star_trek == 1]),
no_exhibit_attendance = sum(quantity[exhibit_total == 0]),
total_exhibit_attendance = sum(quantity[exhibit_total >= 1]),
towers_revenue = sum(extension[towers_of_tomorrow == 1]),
house_revenue = sum(extension[house_industries == 1]),
eames_revenue = sum(extension[charles_and_ray_Eames == 1]),
am_style_revenue = sum(extension[american_style == 1]),
end_ideal_revenue = sum(extension[enduring_ideals == 1]),
eng_exp_revenue = sum(extension[engines_exposed == 1]),
pixar_revenue = sum(extension[pixar == 1]),
star_trek_revenue = sum(extension[star_trek == 1]),
no_exhibit_revenue = sum(extension[exhibit_total == 0]),
total_exhibit_revenue = sum(extension[exhibit_total >= 1]),
main_exhibit_type = first(main_type)
) %>%
filter(transaction_date < COVID_START)
by_day
# remove date and filter negative values and convert to integers
df <- by_day[by_day$revenue >= 0, ]
# df<- subset(df, select = -c(transaction_date) )
df$revenue <- as.integer(df$revenue)
# df <- na.omit(df)
head(df)
# df <- by_day[by_day$adm_count >= 0, ]
# # df<- by_day # comment out for analysis
# df<- subset(df, select = -c(transaction_date) )
# df$adm_count <- as.integer(df$adm_count)
# df <- na.omit(df)
# head(df)
COVID_START <-  as.Date("2020-02-01" , format = "%Y-%m-%d")
by_day <- admission %>%
group_by(transaction_date) %>%
summarise(
adm_count = sum(quantity),
revenue = sum(extension),
cat_general = sum(quantity[category == 'ADMISSION ']),
cat_combo = sum(quantity[category == 'COMBOADMIS']),
# Item
adult = sum(quantity[item == 'ADULT     ']),
youth = sum(quantity[item =='YOUTH     ']),
child = sum(quantity[item=='CHILD     ']),
senior = sum(quantity[item=='SENIOR    ']),
child4 = sum(quantity[item=='CHILD4    ']),
avg_pcsplit_2 = mean(pcsplit_2),
teacher = sum(quantity[item=='TEACHER   ']),
driver = sum(quantity[item=='DRIVER    ']),
avg_transaction_time = mean(times(transaction_time)),
total_michigan = sum(quantity[STATE =="MI"  ]),
###
avg_pr_ctr_1 = mean(pr_ctr_1),
avg_pcsplit_1 = mean(pcsplit_1),
avg_pr_ctr_2 = mean(pr_ctr_2),
total_primary = sum(quantity[MARKET =="Primary"  ]),
total_secondary = sum(quantity[MARKET =="Secondary"  ]),
total_core = sum(quantity[MARKET =="Core"  ]),
total_not_michigan = sum(quantity[STATE !="MI"  ]),
prcp = mean(PRCP_in),
snow = mean(SNOW),
tmax = mean(TMAX_F),
tmin = mean(TMIN_F),
avg_purchase_window = mean(adv_purchase_window),
avg_gas_price = mean(price_per_gallon),
num_discounts = sum(quantity[str_length(special) > 0]),
total_discount_amt = sum(disc_amt),
avg_radius = mean(Radius, na.rm = TRUE),
# Exhibits attendance
towers_attendance = sum(quantity[towers_of_tomorrow == 1]),
house_attendance = sum(quantity[house_industries == 1]),
eames_attendance = sum(quantity[charles_and_ray_Eames == 1]),
am_style_attendance = sum(quantity[american_style == 1]),
end_ideal_attendance = sum(quantity[enduring_ideals == 1]),
eng_exp_attendance = sum(quantity[engines_exposed == 1]),
pixar_attendance = sum(quantity[pixar == 1]),
star_trek_attendance = sum(quantity[star_trek == 1]),
no_exhibit_attendance = sum(quantity[exhibit_total == 0]),
total_exhibit_attendance = sum(quantity[exhibit_total >= 1]),
towers_revenue = sum(extension[towers_of_tomorrow == 1]),
house_revenue = sum(extension[house_industries == 1]),
eames_revenue = sum(extension[charles_and_ray_Eames == 1]),
am_style_revenue = sum(extension[american_style == 1]),
end_ideal_revenue = sum(extension[enduring_ideals == 1]),
eng_exp_revenue = sum(extension[engines_exposed == 1]),
pixar_revenue = sum(extension[pixar == 1]),
star_trek_revenue = sum(extension[star_trek == 1]),
no_exhibit_revenue = sum(extension[exhibit_total == 0]),
total_exhibit_revenue = sum(extension[exhibit_total >= 1]),
main_exhibit_type = first(main_type)
) %>%
filter(transaction_date < COVID_START)
# remove date and filter negative values and convert to integers
df <- by_day[by_day$revenue >= 0, ]
# df<- subset(df, select = -c(transaction_date) )
df$revenue <- as.integer(df$revenue)
# df <- na.omit(df)
head(df)
# df <- by_day[by_day$adm_count >= 0, ]
# # df<- by_day # comment out for analysis
# df<- subset(df, select = -c(transaction_date) )
# df$adm_count <- as.integer(df$adm_count)
# df <- na.omit(df)
# head(df)
COVID_START <-  as.Date("2020-02-01" , format = "%Y-%m-%d")
by_day <- admission %>%
group_by(transaction_date) %>%
summarise(
adm_count = sum(quantity),
revenue = sum(extension),
cat_general = sum(quantity[category == 'ADMISSION ']),
cat_combo = sum(quantity[category == 'COMBOADMIS']),
# Item
adult = sum(quantity[item == 'ADULT     ']),
youth = sum(quantity[item =='YOUTH     ']),
child = sum(quantity[item=='CHILD     ']),
senior = sum(quantity[item=='SENIOR    ']),
child4 = sum(quantity[item=='CHILD4    ']),
avg_pcsplit_2 = mean(pcsplit_2),
teacher = sum(quantity[item=='TEACHER   ']),
driver = sum(quantity[item=='DRIVER    ']),
avg_transaction_time = mean(times(transaction_time)),
total_michigan = sum(quantity[STATE =="MI"  ]),
###
avg_pr_ctr_1 = mean(pr_ctr_1),
avg_pcsplit_1 = mean(pcsplit_1),
avg_pr_ctr_2 = mean(pr_ctr_2),
total_primary = sum(quantity[MARKET =="Primary"  ]),
total_secondary = sum(quantity[MARKET =="Secondary"  ]),
total_core = sum(quantity[MARKET =="Core"  ]),
total_not_michigan = sum(quantity[STATE !="MI"  ]),
prcp = mean(PRCP_in),
snow = mean(SNOW),
tmax = mean(TMAX_F),
tmin = mean(TMIN_F),
avg_purchase_window = mean(adv_purchase_window),
avg_gas_price = mean(price_per_gallon),
num_discounts = sum(quantity[str_length(special) > 0]),
total_discount_amt = sum(disc_amt),
avg_radius = mean(Radius, na.rm = TRUE),
# Exhibits attendance
towers_attendance = sum(quantity[towers_of_tomorrow == 1]),
house_attendance = sum(quantity[house_industries == 1]),
eames_attendance = sum(quantity[charles_and_ray_Eames == 1]),
am_style_attendance = sum(quantity[american_style == 1]),
end_ideal_attendance = sum(quantity[enduring_ideals == 1]),
eng_exp_attendance = sum(quantity[engines_exposed == 1]),
pixar_attendance = sum(quantity[pixar == 1]),
star_trek_attendance = sum(quantity[star_trek == 1]),
no_exhibit_attendance = sum(quantity[exhibit_total == 0]),
total_exhibit_attendance = sum(quantity[exhibit_total >= 1]),
towers_revenue = sum(extension[towers_of_tomorrow == 1]),
house_revenue = sum(extension[house_industries == 1]),
eames_revenue = sum(extension[charles_and_ray_Eames == 1]),
am_style_revenue = sum(extension[american_style == 1]),
end_ideal_revenue = sum(extension[enduring_ideals == 1]),
eng_exp_revenue = sum(extension[engines_exposed == 1]),
pixar_revenue = sum(extension[pixar == 1]),
star_trek_revenue = sum(extension[star_trek == 1]),
no_exhibit_revenue = sum(extension[exhibit_total == 0]),
total_exhibit_revenue = sum(extension[exhibit_total >= 1]),
main_exhibit_type = first(main_type))
# ) %>%
# filter(transaction_date < COVID_START)
write.csv(by_day,"../data/final_csv/by_day.csv", row.names = FALSE)
# remove date and filter negative values and convert to integers
# df <- by_day[by_day$revenue >= 0, ]
# df<- subset(df, select = -c(transaction_date) )
# df$revenue <- as.integer(df$revenue)
# df <- na.omit(df)
# head(df)
# df <- by_day[by_day$adm_count >= 0, ]
# # df<- by_day # comment out for analysis
# df<- subset(df, select = -c(transaction_date) )
# df$adm_count <- as.integer(df$adm_count)
# df <- na.omit(df)
# head(df)
library("MASS")
#use robust regression method
robust_regression_m1<-rlm(GDPCAP ~ TC+TD +logPOP+HDI+ STI:TYPE+STI:PHASE, data = regressiondata)
summary(robust_regression_m1)
regression_m1<-lm(GDPCAP ~ TC+TD +logPOP+HDI+ STI:TYPE+STI:PHASE, data = regressiondata)
summary(regression_m1)
library("dplyr")
library('forecast')
library(tidyverse)
library(leaps)
library(ggplot2)
library(reshape)
library(chron)
admission = read.csv("../data/final_csv/final.csv")
admission$plan_date <- as.Date(admission$plan_date , format = "%Y-%m-%d")
admission$transaction_date <- as.Date(admission$transaction_date , format = "%Y-%m-%d")
admission = subset(admission, select = -c(Date) )
admission$Radius = as.numeric(admission$Radius)
head(admission)
# unique(admission$transaction_date)
## For Candle Stick
temp = read.csv("../../mike_temp/final_quarter.csv")
candle  <- temp %>%
group_by(transaction_date) %>%
summarise(
admis = sum(quantity),
reven = sum(extension)
)
candle
## For Candle Stick
temp = read.csv("../../mike_temp/final_quarter.csv")
temp$transaction_date <- as.Date(temp$transaction_date , format = "%Y-%m-%d")
temp <- temp %>%
order_by(transaction_date)
temp <- temp %>%
arrange(transaction_date)
head(temp)
temp
head(temp)
type.rf <- randomForest(TYPE ~ ., data=regressiondata, importance=TRUE,
proximity=TRUE)
library(randomforest)
install.packages("randomForest")
library(randomforest)
library('randomforest')
library(randomForest)
type.rf <- randomForest(TYPE ~ ., data=regressiondata, importance=TRUE,
proximity=TRUE)
round(importance(type.rf), 2)
head(regressiondata)
round(importance(type.rf), 2)
type.rf <- randomForest(TYPE ~ logTC + logTD + logSTI + logPOP + logGDPCAP + HDI + TC + TD +STI +POP + GDPCAP + PHASE +
mortality_rate + GDP + logGDP, data=regressiondata, importance=TRUE,
proximity=TRUE)
round(importance(type.rf), 2)
MDSplot(type.rf, regressiondata$TYPE)
round(importance(type.rf), 2, k = 4)
round(importance(type.rf), 2, k = 3)
round(importance(type.rf), 2, k = 2)
round(importance(type.rf), 2, k = 1)
MDSplot(type.rf, regressiondata$TYPE, k = 4)
set.seed(1)
data(iris)
iris.rf <- randomForest(Species ~ ., iris, proximity=TRUE,
keep.forest=FALSE)
MDSplot(iris.rf, iris$Species)
## Using different symbols for the classes:
MDSplot(iris.rf, iris$Species, palette=rep(1, 3), pch=as.numeric(iris$Species))
MDSplot(type.rf, regressiondata$TYPE, k = 7)
MDSplot(type.rf, regressiondata$TYPE, k = 15)
MDSplot(type.rf, regressiondata$TYPE, k = 2)
MDSplot(type.rf, regressiondata$TYPE, k = 3)
MDSplot(type.rf, regressiondata$TYPE)
data(iris)
iris
unique(iris$Species)
# Stratified sampling
type.rf2 <- randomForest(TYPE ~ logTC + logTD + logSTI + logPOP + logGDPCAP + HDI + TC + TD +STI +POP + GDPCAP + PHASE +
mortality_rate + GDP + logGDP, data=regressiondata,
sampsize=c(20, 30, 20))
round(importance(type.rf2), 2)
round(importance(type.rf), 2)

